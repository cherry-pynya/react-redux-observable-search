{"ast":null,"code":"import { __assign, __rest } from \"tslib\";\nimport { map } from '../operators/map';\nimport { Observable } from '../Observable';\nimport { AjaxResponse } from './AjaxResponse';\nimport { AjaxTimeoutError, AjaxError } from './errors';\n\nfunction ajaxGet(url, headers) {\n  return ajax({\n    method: 'GET',\n    url: url,\n    headers: headers\n  });\n}\n\nfunction ajaxPost(url, body, headers) {\n  return ajax({\n    method: 'POST',\n    url: url,\n    body: body,\n    headers: headers\n  });\n}\n\nfunction ajaxDelete(url, headers) {\n  return ajax({\n    method: 'DELETE',\n    url: url,\n    headers: headers\n  });\n}\n\nfunction ajaxPut(url, body, headers) {\n  return ajax({\n    method: 'PUT',\n    url: url,\n    body: body,\n    headers: headers\n  });\n}\n\nfunction ajaxPatch(url, body, headers) {\n  return ajax({\n    method: 'PATCH',\n    url: url,\n    body: body,\n    headers: headers\n  });\n}\n\nvar mapResponse = map(function (x) {\n  return x.response;\n});\n\nfunction ajaxGetJSON(url, headers) {\n  return mapResponse(ajax({\n    method: 'GET',\n    url: url,\n    headers: headers\n  }));\n}\n\nexport var ajax = function () {\n  var create = function (urlOrConfig) {\n    var config = typeof urlOrConfig === 'string' ? {\n      url: urlOrConfig\n    } : urlOrConfig;\n    return fromAjax(config);\n  };\n\n  create.get = ajaxGet;\n  create.post = ajaxPost;\n  create.delete = ajaxDelete;\n  create.put = ajaxPut;\n  create.patch = ajaxPatch;\n  create.getJSON = ajaxGetJSON;\n  return create;\n}();\nvar UPLOAD = 'upload';\nvar DOWNLOAD = 'download';\nvar LOADSTART = 'loadstart';\nvar PROGRESS = 'progress';\nvar LOAD = 'load';\nexport function fromAjax(config) {\n  return new Observable(function (destination) {\n    var _a, _b;\n\n    var queryParams = config.queryParams,\n        configuredBody = config.body,\n        configuredHeaders = config.headers,\n        remainingConfig = __rest(config, [\"queryParams\", \"body\", \"headers\"]);\n\n    var url = remainingConfig.url;\n\n    if (!url) {\n      throw new TypeError('url is required');\n    }\n\n    if (queryParams) {\n      var searchParams_1;\n\n      if (url.includes('?')) {\n        var parts = url.split('?');\n\n        if (2 < parts.length) {\n          throw new TypeError('invalid url');\n        }\n\n        searchParams_1 = new URLSearchParams(parts[1]);\n        new URLSearchParams(queryParams).forEach(function (value, key) {\n          return searchParams_1.set(key, value);\n        });\n        url = parts[0] + '?' + searchParams_1;\n      } else {\n        searchParams_1 = new URLSearchParams(queryParams);\n        url = url + '?' + searchParams_1;\n      }\n    }\n\n    var headers = {};\n\n    if (configuredHeaders) {\n      for (var key in configuredHeaders) {\n        if (configuredHeaders.hasOwnProperty(key)) {\n          headers[key.toLowerCase()] = configuredHeaders[key];\n        }\n      }\n    }\n\n    if (!config.crossDomain && !('x-requested-with' in headers)) {\n      headers['x-requested-with'] = 'XMLHttpRequest';\n    }\n\n    var withCredentials = remainingConfig.withCredentials,\n        xsrfCookieName = remainingConfig.xsrfCookieName,\n        xsrfHeaderName = remainingConfig.xsrfHeaderName;\n\n    if ((withCredentials || !remainingConfig.crossDomain) && xsrfCookieName && xsrfHeaderName) {\n      var xsrfCookie = (_b = (_a = document === null || document === void 0 ? void 0 : document.cookie.match(new RegExp(\"(^|;\\\\s*)(\" + xsrfCookieName + \")=([^;]*)\"))) === null || _a === void 0 ? void 0 : _a.pop()) !== null && _b !== void 0 ? _b : '';\n\n      if (xsrfCookie) {\n        headers[xsrfHeaderName] = xsrfCookie;\n      }\n    }\n\n    var body = extractContentTypeAndMaybeSerializeBody(configuredBody, headers);\n\n    var _request = __assign(__assign({\n      async: true,\n      crossDomain: true,\n      withCredentials: false,\n      method: 'GET',\n      timeout: 0,\n      responseType: 'json'\n    }, remainingConfig), {\n      url: url,\n      headers: headers,\n      body: body\n    });\n\n    var xhr;\n    xhr = config.createXHR ? config.createXHR() : new XMLHttpRequest();\n    {\n      var progressSubscriber_1 = config.progressSubscriber,\n          _c = config.includeDownloadProgress,\n          includeDownloadProgress = _c === void 0 ? false : _c,\n          _d = config.includeUploadProgress,\n          includeUploadProgress = _d === void 0 ? false : _d;\n\n      var addErrorEvent = function (type, errorFactory) {\n        xhr.addEventListener(type, function () {\n          var _a;\n\n          var error = errorFactory();\n          (_a = progressSubscriber_1 === null || progressSubscriber_1 === void 0 ? void 0 : progressSubscriber_1.error) === null || _a === void 0 ? void 0 : _a.call(progressSubscriber_1, error);\n          destination.error(error);\n        });\n      };\n\n      addErrorEvent('timeout', function () {\n        return new AjaxTimeoutError(xhr, _request);\n      });\n      addErrorEvent('abort', function () {\n        return new AjaxError('aborted', xhr, _request);\n      });\n\n      var createResponse_1 = function (direction, event) {\n        return new AjaxResponse(event, xhr, _request, direction + \"_\" + event.type);\n      };\n\n      var addProgressEvent_1 = function (target, type, direction) {\n        target.addEventListener(type, function (event) {\n          destination.next(createResponse_1(direction, event));\n        });\n      };\n\n      if (includeUploadProgress) {\n        [LOADSTART, PROGRESS, LOAD].forEach(function (type) {\n          return addProgressEvent_1(xhr.upload, type, UPLOAD);\n        });\n      }\n\n      if (progressSubscriber_1) {\n        [LOADSTART, PROGRESS].forEach(function (type) {\n          return xhr.upload.addEventListener(type, function (e) {\n            var _a;\n\n            return (_a = progressSubscriber_1 === null || progressSubscriber_1 === void 0 ? void 0 : progressSubscriber_1.next) === null || _a === void 0 ? void 0 : _a.call(progressSubscriber_1, e);\n          });\n        });\n      }\n\n      if (includeDownloadProgress) {\n        [LOADSTART, PROGRESS].forEach(function (type) {\n          return addProgressEvent_1(xhr, type, DOWNLOAD);\n        });\n      }\n\n      var emitError_1 = function (status) {\n        var msg = 'ajax error' + (status ? ' ' + status : '');\n        destination.error(new AjaxError(msg, xhr, _request));\n      };\n\n      xhr.addEventListener('error', function (e) {\n        var _a;\n\n        (_a = progressSubscriber_1 === null || progressSubscriber_1 === void 0 ? void 0 : progressSubscriber_1.error) === null || _a === void 0 ? void 0 : _a.call(progressSubscriber_1, e);\n        emitError_1();\n      });\n      xhr.addEventListener(LOAD, function (event) {\n        var _a, _b;\n\n        var status = xhr.status;\n\n        if (status < 400) {\n          (_a = progressSubscriber_1 === null || progressSubscriber_1 === void 0 ? void 0 : progressSubscriber_1.complete) === null || _a === void 0 ? void 0 : _a.call(progressSubscriber_1);\n          var response = void 0;\n\n          try {\n            response = createResponse_1(DOWNLOAD, event);\n          } catch (err) {\n            destination.error(err);\n            return;\n          }\n\n          destination.next(response);\n          destination.complete();\n        } else {\n          (_b = progressSubscriber_1 === null || progressSubscriber_1 === void 0 ? void 0 : progressSubscriber_1.error) === null || _b === void 0 ? void 0 : _b.call(progressSubscriber_1, event);\n          emitError_1(status);\n        }\n      });\n    }\n    var user = _request.user,\n        method = _request.method,\n        async = _request.async;\n\n    if (user) {\n      xhr.open(method, url, async, user, _request.password);\n    } else {\n      xhr.open(method, url, async);\n    }\n\n    if (async) {\n      xhr.timeout = _request.timeout;\n      xhr.responseType = _request.responseType;\n    }\n\n    if ('withCredentials' in xhr) {\n      xhr.withCredentials = _request.withCredentials;\n    }\n\n    for (var key in headers) {\n      if (headers.hasOwnProperty(key)) {\n        xhr.setRequestHeader(key, headers[key]);\n      }\n    }\n\n    if (body) {\n      xhr.send(body);\n    } else {\n      xhr.send();\n    }\n\n    return function () {\n      if (xhr && xhr.readyState !== 4) {\n        xhr.abort();\n      }\n    };\n  });\n}\n\nfunction extractContentTypeAndMaybeSerializeBody(body, headers) {\n  var _a;\n\n  if (!body || typeof body === 'string' || isFormData(body) || isURLSearchParams(body) || isArrayBuffer(body) || isFile(body) || isBlob(body) || isReadableStream(body)) {\n    return body;\n  }\n\n  if (isArrayBufferView(body)) {\n    return body.buffer;\n  }\n\n  if (typeof body === 'object') {\n    headers['content-type'] = (_a = headers['content-type']) !== null && _a !== void 0 ? _a : 'application/json;charset=utf-8';\n    return JSON.stringify(body);\n  }\n\n  throw new TypeError('Unknown body type');\n}\n\nvar _toString = Object.prototype.toString;\n\nfunction toStringCheck(obj, name) {\n  return _toString.call(obj) === \"[object \" + name + \"]\";\n}\n\nfunction isArrayBuffer(body) {\n  return toStringCheck(body, 'ArrayBuffer');\n}\n\nfunction isFile(body) {\n  return toStringCheck(body, 'File');\n}\n\nfunction isBlob(body) {\n  return toStringCheck(body, 'Blob');\n}\n\nfunction isArrayBufferView(body) {\n  return typeof ArrayBuffer !== 'undefined' && ArrayBuffer.isView(body);\n}\n\nfunction isFormData(body) {\n  return typeof FormData !== 'undefined' && body instanceof FormData;\n}\n\nfunction isURLSearchParams(body) {\n  return typeof URLSearchParams !== 'undefined' && body instanceof URLSearchParams;\n}\n\nfunction isReadableStream(body) {\n  return typeof ReadableStream !== 'undefined' && body instanceof ReadableStream;\n}","map":{"version":3,"sources":["../../../../src/internal/ajax/ajax.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign, __rest } from \"tslib\";\nimport { map } from '../operators/map';\nimport { Observable } from '../Observable';\nimport { AjaxResponse } from './AjaxResponse';\nimport { AjaxTimeoutError, AjaxError } from './errors';\nfunction ajaxGet(url, headers) {\n    return ajax({ method: 'GET', url: url, headers: headers });\n}\nfunction ajaxPost(url, body, headers) {\n    return ajax({ method: 'POST', url: url, body: body, headers: headers });\n}\nfunction ajaxDelete(url, headers) {\n    return ajax({ method: 'DELETE', url: url, headers: headers });\n}\nfunction ajaxPut(url, body, headers) {\n    return ajax({ method: 'PUT', url: url, body: body, headers: headers });\n}\nfunction ajaxPatch(url, body, headers) {\n    return ajax({ method: 'PATCH', url: url, body: body, headers: headers });\n}\nvar mapResponse = map(function (x) { return x.response; });\nfunction ajaxGetJSON(url, headers) {\n    return mapResponse(ajax({\n        method: 'GET',\n        url: url,\n        headers: headers,\n    }));\n}\nexport var ajax = (function () {\n    var create = function (urlOrConfig) {\n        var config = typeof urlOrConfig === 'string'\n            ? {\n                url: urlOrConfig,\n            }\n            : urlOrConfig;\n        return fromAjax(config);\n    };\n    create.get = ajaxGet;\n    create.post = ajaxPost;\n    create.delete = ajaxDelete;\n    create.put = ajaxPut;\n    create.patch = ajaxPatch;\n    create.getJSON = ajaxGetJSON;\n    return create;\n})();\nvar UPLOAD = 'upload';\nvar DOWNLOAD = 'download';\nvar LOADSTART = 'loadstart';\nvar PROGRESS = 'progress';\nvar LOAD = 'load';\nexport function fromAjax(config) {\n    return new Observable(function (destination) {\n        var _a, _b;\n        var queryParams = config.queryParams, configuredBody = config.body, configuredHeaders = config.headers, remainingConfig = __rest(config, [\"queryParams\", \"body\", \"headers\"]);\n        var url = remainingConfig.url;\n        if (!url) {\n            throw new TypeError('url is required');\n        }\n        if (queryParams) {\n            var searchParams_1;\n            if (url.includes('?')) {\n                var parts = url.split('?');\n                if (2 < parts.length) {\n                    throw new TypeError('invalid url');\n                }\n                searchParams_1 = new URLSearchParams(parts[1]);\n                new URLSearchParams(queryParams).forEach(function (value, key) { return searchParams_1.set(key, value); });\n                url = parts[0] + '?' + searchParams_1;\n            }\n            else {\n                searchParams_1 = new URLSearchParams(queryParams);\n                url = url + '?' + searchParams_1;\n            }\n        }\n        var headers = {};\n        if (configuredHeaders) {\n            for (var key in configuredHeaders) {\n                if (configuredHeaders.hasOwnProperty(key)) {\n                    headers[key.toLowerCase()] = configuredHeaders[key];\n                }\n            }\n        }\n        if (!config.crossDomain && !('x-requested-with' in headers)) {\n            headers['x-requested-with'] = 'XMLHttpRequest';\n        }\n        var withCredentials = remainingConfig.withCredentials, xsrfCookieName = remainingConfig.xsrfCookieName, xsrfHeaderName = remainingConfig.xsrfHeaderName;\n        if ((withCredentials || !remainingConfig.crossDomain) && xsrfCookieName && xsrfHeaderName) {\n            var xsrfCookie = (_b = (_a = document === null || document === void 0 ? void 0 : document.cookie.match(new RegExp(\"(^|;\\\\s*)(\" + xsrfCookieName + \")=([^;]*)\"))) === null || _a === void 0 ? void 0 : _a.pop()) !== null && _b !== void 0 ? _b : '';\n            if (xsrfCookie) {\n                headers[xsrfHeaderName] = xsrfCookie;\n            }\n        }\n        var body = extractContentTypeAndMaybeSerializeBody(configuredBody, headers);\n        var _request = __assign(__assign({ async: true, crossDomain: true, withCredentials: false, method: 'GET', timeout: 0, responseType: 'json' }, remainingConfig), { url: url,\n            headers: headers,\n            body: body });\n        var xhr;\n        xhr = config.createXHR ? config.createXHR() : new XMLHttpRequest();\n        {\n            var progressSubscriber_1 = config.progressSubscriber, _c = config.includeDownloadProgress, includeDownloadProgress = _c === void 0 ? false : _c, _d = config.includeUploadProgress, includeUploadProgress = _d === void 0 ? false : _d;\n            var addErrorEvent = function (type, errorFactory) {\n                xhr.addEventListener(type, function () {\n                    var _a;\n                    var error = errorFactory();\n                    (_a = progressSubscriber_1 === null || progressSubscriber_1 === void 0 ? void 0 : progressSubscriber_1.error) === null || _a === void 0 ? void 0 : _a.call(progressSubscriber_1, error);\n                    destination.error(error);\n                });\n            };\n            addErrorEvent('timeout', function () { return new AjaxTimeoutError(xhr, _request); });\n            addErrorEvent('abort', function () { return new AjaxError('aborted', xhr, _request); });\n            var createResponse_1 = function (direction, event) {\n                return new AjaxResponse(event, xhr, _request, direction + \"_\" + event.type);\n            };\n            var addProgressEvent_1 = function (target, type, direction) {\n                target.addEventListener(type, function (event) {\n                    destination.next(createResponse_1(direction, event));\n                });\n            };\n            if (includeUploadProgress) {\n                [LOADSTART, PROGRESS, LOAD].forEach(function (type) { return addProgressEvent_1(xhr.upload, type, UPLOAD); });\n            }\n            if (progressSubscriber_1) {\n                [LOADSTART, PROGRESS].forEach(function (type) { return xhr.upload.addEventListener(type, function (e) { var _a; return (_a = progressSubscriber_1 === null || progressSubscriber_1 === void 0 ? void 0 : progressSubscriber_1.next) === null || _a === void 0 ? void 0 : _a.call(progressSubscriber_1, e); }); });\n            }\n            if (includeDownloadProgress) {\n                [LOADSTART, PROGRESS].forEach(function (type) { return addProgressEvent_1(xhr, type, DOWNLOAD); });\n            }\n            var emitError_1 = function (status) {\n                var msg = 'ajax error' + (status ? ' ' + status : '');\n                destination.error(new AjaxError(msg, xhr, _request));\n            };\n            xhr.addEventListener('error', function (e) {\n                var _a;\n                (_a = progressSubscriber_1 === null || progressSubscriber_1 === void 0 ? void 0 : progressSubscriber_1.error) === null || _a === void 0 ? void 0 : _a.call(progressSubscriber_1, e);\n                emitError_1();\n            });\n            xhr.addEventListener(LOAD, function (event) {\n                var _a, _b;\n                var status = xhr.status;\n                if (status < 400) {\n                    (_a = progressSubscriber_1 === null || progressSubscriber_1 === void 0 ? void 0 : progressSubscriber_1.complete) === null || _a === void 0 ? void 0 : _a.call(progressSubscriber_1);\n                    var response = void 0;\n                    try {\n                        response = createResponse_1(DOWNLOAD, event);\n                    }\n                    catch (err) {\n                        destination.error(err);\n                        return;\n                    }\n                    destination.next(response);\n                    destination.complete();\n                }\n                else {\n                    (_b = progressSubscriber_1 === null || progressSubscriber_1 === void 0 ? void 0 : progressSubscriber_1.error) === null || _b === void 0 ? void 0 : _b.call(progressSubscriber_1, event);\n                    emitError_1(status);\n                }\n            });\n        }\n        var user = _request.user, method = _request.method, async = _request.async;\n        if (user) {\n            xhr.open(method, url, async, user, _request.password);\n        }\n        else {\n            xhr.open(method, url, async);\n        }\n        if (async) {\n            xhr.timeout = _request.timeout;\n            xhr.responseType = _request.responseType;\n        }\n        if ('withCredentials' in xhr) {\n            xhr.withCredentials = _request.withCredentials;\n        }\n        for (var key in headers) {\n            if (headers.hasOwnProperty(key)) {\n                xhr.setRequestHeader(key, headers[key]);\n            }\n        }\n        if (body) {\n            xhr.send(body);\n        }\n        else {\n            xhr.send();\n        }\n        return function () {\n            if (xhr && xhr.readyState !== 4) {\n                xhr.abort();\n            }\n        };\n    });\n}\nfunction extractContentTypeAndMaybeSerializeBody(body, headers) {\n    var _a;\n    if (!body ||\n        typeof body === 'string' ||\n        isFormData(body) ||\n        isURLSearchParams(body) ||\n        isArrayBuffer(body) ||\n        isFile(body) ||\n        isBlob(body) ||\n        isReadableStream(body)) {\n        return body;\n    }\n    if (isArrayBufferView(body)) {\n        return body.buffer;\n    }\n    if (typeof body === 'object') {\n        headers['content-type'] = (_a = headers['content-type']) !== null && _a !== void 0 ? _a : 'application/json;charset=utf-8';\n        return JSON.stringify(body);\n    }\n    throw new TypeError('Unknown body type');\n}\nvar _toString = Object.prototype.toString;\nfunction toStringCheck(obj, name) {\n    return _toString.call(obj) === \"[object \" + name + \"]\";\n}\nfunction isArrayBuffer(body) {\n    return toStringCheck(body, 'ArrayBuffer');\n}\nfunction isFile(body) {\n    return toStringCheck(body, 'File');\n}\nfunction isBlob(body) {\n    return toStringCheck(body, 'Blob');\n}\nfunction isArrayBufferView(body) {\n    return typeof ArrayBuffer !== 'undefined' && ArrayBuffer.isView(body);\n}\nfunction isFormData(body) {\n    return typeof FormData !== 'undefined' && body instanceof FormData;\n}\nfunction isURLSearchParams(body) {\n    return typeof URLSearchParams !== 'undefined' && body instanceof URLSearchParams;\n}\nfunction isReadableStream(body) {\n    return typeof ReadableStream !== 'undefined' && body instanceof ReadableStream;\n}\n//# sourceMappingURL=ajax.js.map"]},"metadata":{},"sourceType":"module"}