{"ast":null,"code":"import { createSlice } from \"@reduxjs/toolkit\";\nimport { PENDING, SUCCESS, ERROR, URL } from \"../params/params\";\nimport { ofType } from \"redux-observable\";\nimport { of } from \"rxjs\";\nimport { ajax } from \"rxjs/ajax\";\nimport { map, filter, debounceTime, switchMap, catchError, retry, pipe, mergeMap } from \"rxjs/operators\";\nexport const searchSlice = createSlice({\n  name: \"search\",\n  initialState: {\n    status: PENDING,\n    data: [],\n    inputEmpty: true,\n    search: \"\"\n  },\n  reducers: {\n    setData: (state, action) => {\n      state.data = action.payload;\n    },\n    inputEmptyTrue: state => {\n      state.inputEmpty = true;\n    },\n    inputEmptyFalse: state => {\n      state.inputEmpty = false;\n    },\n    statusPending: state => {\n      state.status = PENDING;\n    },\n    statusSuccess: state => {\n      state.status = SUCCESS;\n    },\n    statusError: state => {\n      state.status = ERROR;\n    },\n    request: (state, action) => {\n      state.status = PENDING;\n    },\n    changeSearchField: (state, action) => {\n      state.search = action.payload;\n    }\n  }\n});\nexport const changeEpic = actions$ => actions$.pipe(ofType(searchSlice.actions.changeSearchField), map(o => o.payload.trim()), debounceTime(100), mergeMap(o => {\n  if (o === \"\") {\n    setData([]);\n  } else {\n    return of(request(o));\n  }\n}));\nexport const searchEpic = action$ => action$.pipe(ofType(searchSlice.actions.request), map(o => o.payload), map(o => new URLSearchParams({\n  q: o\n})), switchMap(o => ajax.getJSON(`${URL}?${o}`).pipe(retry(3), map(o => setData(o)), statusSuccess(), catchError(e => of(statusError())))));\nexport const {\n  setData,\n  inputEmptyFalse,\n  statusPending,\n  statusSuccess,\n  statusError,\n  inputEmptyTrue,\n  request,\n  changeSearchField\n} = searchSlice.actions;\nexport default searchSlice.reducer;","map":{"version":3,"sources":["/Users/nikitacerepna/Desktop/netology/react/observable/react-redux-observable-search/src/slices/searchSlice.js"],"names":["createSlice","PENDING","SUCCESS","ERROR","URL","ofType","of","ajax","map","filter","debounceTime","switchMap","catchError","retry","pipe","mergeMap","searchSlice","name","initialState","status","data","inputEmpty","search","reducers","setData","state","action","payload","inputEmptyTrue","inputEmptyFalse","statusPending","statusSuccess","statusError","request","changeSearchField","changeEpic","actions$","actions","o","trim","searchEpic","action$","URLSearchParams","q","getJSON","e","reducer"],"mappings":"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","sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\r\nimport { PENDING, SUCCESS, ERROR, URL } from \"../params/params\";\r\nimport { ofType } from \"redux-observable\";\r\nimport { of } from \"rxjs\";\r\nimport { ajax } from \"rxjs/ajax\";\r\nimport {\r\n  map,\r\n  filter,\r\n  debounceTime,\r\n  switchMap,\r\n  catchError,\r\n  retry,\r\n  pipe,\r\n  mergeMap,\r\n} from \"rxjs/operators\";\r\n\r\nexport const searchSlice = createSlice({\r\n  name: \"search\",\r\n  initialState: {\r\n    status: PENDING,\r\n    data: [],\r\n    inputEmpty: true,\r\n    search: \"\",\r\n  },\r\n  reducers: {\r\n    setData: (state, action) => {\r\n      state.data = action.payload;\r\n    },\r\n    inputEmptyTrue: (state) => {\r\n      state.inputEmpty = true;\r\n    },\r\n    inputEmptyFalse: (state) => {\r\n      state.inputEmpty = false;\r\n    },\r\n    statusPending: (state) => {\r\n      state.status = PENDING;\r\n    },\r\n    statusSuccess: (state) => {\r\n      state.status = SUCCESS;\r\n    },\r\n    statusError: (state) => {\r\n      state.status = ERROR;\r\n    },\r\n    request: (state, action) => {\r\n      state.status = PENDING;\r\n    },\r\n    changeSearchField: (state, action) => {\r\n      state.search = action.payload;\r\n    },\r\n  },\r\n});\r\n\r\nexport const changeEpic = (actions$) =>\r\n  actions$.pipe(\r\n    ofType(searchSlice.actions.changeSearchField),\r\n    map((o) => o.payload.trim()),\r\n    debounceTime(100),\r\n    mergeMap((o) => {\r\n      if (o === \"\") {\r\n        setData([]);\r\n      } else {\r\n        return of(request(o));\r\n      }\r\n    })\r\n  );\r\n\r\nexport const searchEpic = (action$) =>\r\n  action$.pipe(\r\n    ofType(searchSlice.actions.request),\r\n    map((o) => o.payload),\r\n    map((o) => new URLSearchParams({ q: o })),\r\n    switchMap((o) =>\r\n      ajax.getJSON(`${URL}?${o}`).pipe(\r\n        retry(3),\r\n        map((o) => setData(o)),\r\n        statusSuccess(),\r\n        catchError((e) => of(statusError()))\r\n      )\r\n    )\r\n  );\r\n\r\nexport const {\r\n  setData,\r\n  inputEmptyFalse,\r\n  statusPending,\r\n  statusSuccess,\r\n  statusError,\r\n  inputEmptyTrue,\r\n  request,\r\n  changeSearchField,\r\n} = searchSlice.actions;\r\n\r\nexport default searchSlice.reducer;\r\n"]},"metadata":{},"sourceType":"module"}